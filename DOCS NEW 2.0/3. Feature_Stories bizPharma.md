# bizPharma - Comprehensive Feature Stories

## Features List

### Authentication & User Management

#### Anonymous Trial Signup

**User Stories**

* As a first-time visitor, I want to start using the app immediately without creating an account, so that I can evaluate the software before committing.
* As an anonymous user, I want to go through a complete onboarding process including business setup, so that I can test the app with realistic data.
* As an anonymous user, I want clear visibility of my trial limitations and expiry date, so that I understand when I need to upgrade.
* As a business owner, I want to know exactly what features are limited during the trial, so that I can plan my evaluation properly.

**UX/UI Considerations**

**Core Experience**

1. **Landing Screen**: User opens app and sees two prominent options: "Start Free Trial" (primary CTA) and "Sign In" (secondary). The trial CTA displays "4 weeks • Full features • No credit card" as subtext.

2. **Instant Trial Creation**: Upon tapping "Start Free Trial", the system creates an anonymous Firebase account in the background (< 1 second), shows a brief success animation (green checkmark with "Trial activated" message), then immediately transitions to the onboarding wizard.

3. **Onboarding Wizard Progress**: A horizontal stepper at the top shows "1 of 3", "2 of 3", "3 of 3" with visual indicators. Each step has a descriptive title and estimated time ("2 min").

4. **Step 1 - Business Information**: Form fields for business name (required), contact number (required), primary address (optional). Input fields have clear labels above and helper text below. Real-time validation with inline error messages (red text + icon). "Continue" button disabled until required fields are valid.

5. **Step 2 - Currency & Tax Configuration**: Dropdown for currency selection (defaults to PKR based on device location). Tax regime selection with visual cards: "Pakistan (GST/Sales Tax)" vs "Other Country (Custom)". Fiscal year start month picker. All fields pre-populated with sensible defaults but editable.

6. **Step 3 - First Location Setup**: Location name (defaults to "Main Store"), location type selection (Retail Pharmacy / Wholesale Pharmacy / Mixed), address. Toggle for "This is my only location" vs "I have multiple locations (can add later)".

7. **Sample Data Option**: At the end of onboarding, a full-screen prompt: "Would you like us to add sample products and transactions to help you learn?" with Yes/No buttons. If Yes, system pre-populates 50 sample products, 10 sample customers, 5 sample transactions.

8. **Trial Dashboard**: After onboarding, user lands on dashboard with a persistent trial banner at top: "Trial: 28 days remaining • 0/500 products • 0/500 transactions today" with "Upgrade Now" link. Banner uses soft yellow background with orange accent.

**States**

* **Empty State**: Dashboard shows empty state illustrations with CTAs: "Add your first product", "Make your first sale", "Import existing data"
* **Active Trial**: Banner updates daily showing remaining days, used limits (products, transactions, suppliers)
* **Approaching Limits**: When >80% of any limit used, banner turns orange: "450/500 products used - Upgrade for unlimited"
* **Trial Expiring Soon**: When <7 days remain, banner turns red with urgent messaging: "6 days left - Upgrade now to keep your data"

**Visual Hierarchy**

* Primary action buttons (Continue, Start Trial) use brand primary color, large size (min 44px height), bold text
* Secondary actions (Skip, Back) use ghost buttons with subtle borders
* Progress indicators use color coding: incomplete (gray), current (brand primary), completed (green)
* Form field focus states have smooth blue glow animation

**Animations**

* Wizard transitions: Smooth slide animation (300ms ease-in-out) when moving between steps
* Success states: Gentle scale + fade animation (checkmark grows from 0.8x to 1x over 400ms)
* Trial banner: Subtle pulse animation on "Upgrade Now" button every 5 seconds

**Advanced Users & Edge Cases**

**Edge Case: Trial Expiry During Active Session**

* **State**: User is mid-transaction when trial expires
* **Handling**: System shows modal overlay (can't dismiss): "Your trial has expired. Complete this transaction, then upgrade to continue." Transaction can be completed but new transactions blocked.
* **Visual**: Modal has dark semi-transparent backdrop, white card with yellow warning icon, clear messaging, prominent "Upgrade Now" button

**Edge Case: Hitting Transaction Limit Mid-Day**

* **State**: User reaches 500 transactions during business hours
* **Handling**: After 500th transaction completes successfully, system shows full-screen blocker: "Daily transaction limit reached (500/500). Upgrade for unlimited transactions or wait until tomorrow."
* **Visual**: Can't access POS until next day or upgrade. Dashboard shows countdown timer: "Resets in 8 hours 23 minutes"

**Edge Case: Multiple Devices with Same Anonymous Account**

* **State**: User tries to log into same anonymous account on second device
* **Handling**: System allows it but shows warning: "Your trial account is active on another device. Data syncs automatically but we recommend upgrading for multi-device support."
* **Visual**: Dismissible banner on dashboard

**Edge Case: Closing App During Onboarding**

* **State**: User exits app after completing step 1 of 3
* **Handling**: On reopen, app resumes at step 2 with data from step 1 saved. Top banner: "Complete your setup (2 of 3 remaining)"
* **Visual**: Can skip remaining steps via "Finish Later" link, lands on partially configured dashboard

---

#### Anonymous to Authenticated Upgrade

**User Stories**

* As an anonymous user approaching trial expiry, I want to upgrade to a full account without losing any data, so that my business operations continue seamlessly.
* As an anonymous user who added test data during trial, I want to selectively keep or discard that data when upgrading, so that my real business starts clean or retains useful sample data.
* As a business owner, I want to choose which trial data becomes permanent (products, customers, transactions), so that I don't mix test and real data.
* As a paying customer, I want immediate access to all premium features after payment, so that I can scale my operations without delays.

**UX/UI Considerations**

**Core Experience**

1. **Upgrade Entry Points**: Multiple paths to upgrade:
   - Trial banner "Upgrade Now" button (always visible)
   - Modal when approaching limits: "You've used 450/500 products - Upgrade for unlimited"
   - Full-screen blocker when trial expires
   - Settings → Subscription section

2. **Upgrade Flow Start**: Tapping "Upgrade Now" opens upgrade screen with three sections:
   - Current trial status (days left, limits used)
   - Plan comparison table (Trial vs Paid features)
   - "Select Plan" button

3. **Plan Selection**: Shows pricing tiers with radio buttons:
   - **Monthly**: PKR 500/month (billed monthly)
   - **Annual**: PKR 400/month (PKR 4,800 upfront - save 20%)
   - **Annual with Installments**: PKR 60,000 upfront + PKR 400/month annual renewal (6 months installments available)
   
   Each plan card shows: price, billing frequency, included features (3 users, 5 base roles, unlimited inventory/transactions), what happens to trial data.

4. **Data Migration Decision Screen**: After plan selection but before payment, full-screen wizard titled "What should we do with your trial data?"
   
   Three expandable sections with checkboxes:
   
   **Section 1: Products (50 items)**
   - ☐ Keep all products (they'll become part of your real inventory)
   - ☐ Mark all as sample data (archived but not deleted, accessible via "Sample Data" filter)
   - ☐ Let me choose individually (opens product selection screen)
   
   **Section 2: Customers (10 contacts)**
   - Same options as products
   
   **Section 3: Transactions (23 sales)**
   - ☐ Keep all transactions (they'll appear in your financial reports)
   - ☐ Archive as sample data (excluded from reports, visible in "Sample Transactions" view)
   - ☐ Delete all transactions (cannot be undone)

5. **Individual Selection Mode**: If user chooses "Let me choose individually":
   - Scrollable list of all products with checkboxes
   - Bulk actions: "Select All", "Clear All"
   - Search and filter to find specific items
   - Selected count at bottom: "12 of 50 selected to keep"
   - Confirm button: "Keep 12 products, archive 38"

6. **Payment Integration**: After data migration decisions, redirect to Paddle.com checkout:
   - Pre-filled with business info from trial
   - Payment methods: Credit Card, Bank Transfer (for annual upfront)
   - Paddle handles all payment processing, returns success/failure webhook

7. **Authentication Prompt**: After successful payment, modal prompts: "Secure your account - Sign in with:"
   - Google (one-tap if available)
   - Email & Password (form with validation)
   - Facebook
   - Phone Number
   
   Subtext: "This will convert your trial account to a full account while keeping your business data."

8. **Background Conversion**: After auth method selected:
   - Loading screen: "Setting up your account... Migrating your data..."
   - Progress indicators: "Converting anonymous account ✓", "Processing data migration ✓", "Activating premium features ✓"
   - Takes 5-15 seconds

9. **Welcome Screen**: After conversion complete, celebratory screen:
   - Success animation (confetti or checkmark)
   - "Welcome to bizPharma!"
   - Summary: "Your account is now active. [X] products migrated, [Y] archived as samples."
   - "Get Started" button → Dashboard

10. **Post-Upgrade Dashboard**: Dashboard with premium features unlocked:
    - Trial banner replaced with subscription status: "Premium Plan • Renews on [date]"
    - All limits removed
    - Access to premium roles, additional user seats
    - "Invite Team Members" CTA prominent

**States**

* **Pre-Upgrade**: Trial banner shows urgency ("Upgrade to keep your data")
* **During Payment**: Loading overlay while Paddle checkout is open
* **Payment Failed**: Error modal with retry option and support contact
* **Data Migration**: Progress screen with animated steps
* **Post-Upgrade**: Dashboard shows "What's New" tooltip tour highlighting unlocked features

**Visual Hierarchy**

* Plan cards: Most popular plan (Annual) has "Best Value" badge and subtle border glow
* Data migration checkboxes: Large, touch-friendly (min 32px), with clear labels
* Critical decisions (delete transactions) have red warning icons
* Payment success: Green checkmark with scale-up animation

**Animations**

* Plan selection: Cards have hover/tap states with subtle lift effect (4px shadow)
* Data migration: Smooth expand/collapse for sections (200ms ease)
* Conversion progress: Each step checkmark appears with 300ms delay for spatial continuity
* Success celebration: Confetti particles fall from top (1.5s animation) or checkmark grows with elastic easing

**Advanced Users & Edge Cases**

**Edge Case: Payment Failure**

* **State**: Paddle webhook returns payment failed
* **Handling**: User lands on error screen: "Payment could not be processed. Please try again or contact support."
* **Visual**: Red alert icon, retry button (reopens Paddle checkout), "Contact Support" link
* **Fallback**: Anonymous account remains active with original trial expiry date

**Edge Case: User Closes App During Data Migration**

* **State**: App closed while "Processing data migration" is running
* **Handling**: Migration is handled server-side, continues in background. On reopen, shows "Finalizing your upgrade..." then lands on welcome screen when done.
* **Visual**: Can't access app features until migration completes (overlay blocker)

**Edge Case: Authentication Link Fails (Firebase error)**

* **State**: Firebase can't link anonymous account to new auth provider
* **Handling**: System creates new authenticated account and migrates data to it. Shows info message: "We created a fresh account for you with all your trial data migrated."
* **Visual**: Yellow info banner (not error, just informational)

**Edge Case: Partial Data Migration (some items fail)**

* **State**: 48/50 products migrated successfully, 2 failed due to duplicate barcodes
* **Handling**: Show warning modal: "2 products couldn't be migrated (duplicate barcodes). Review them in Settings → Data Migration Report."
* **Visual**: Yellow warning banner on dashboard for first 7 days, dismissible

**Edge Case: User Wants to Reverse Migration Decision**

* **State**: User archived products but now wants them back in active inventory
* **Handling**: Settings → Data Migration → "Restore Sample Data". Shows list of archived items with restore buttons.
* **Visual**: Batch restore available: "Restore all 38 archived products"
* **Limitation**: Only available for 90 days post-upgrade

**Edge Case: Multiple Anonymous Sessions (user used app on 2 devices)**

* **State**: User has different trial data on Phone A vs Tablet B
* **Handling**: During upgrade, system asks: "We found trial data on multiple devices. Which one do you want to keep?" Shows device names and data counts.
* **Visual**: Two cards side-by-side with data summaries, user selects one
* **Fallback**: If user doesn't choose, most recent activity wins

---

#### Role-Based Access Control & Permissions

**User Stories**

* As a Business Admin, I want to assign specific roles to employees, so that they only access features relevant to their job.
* As a Store Manager, I want to control which cashiers can approve discounts, so that pricing integrity is maintained.
* As an employee with multiple roles, I want a single dashboard that shows relevant information for all my responsibilities, so that I don't need to switch contexts.
* As an Operations Manager, I want granular permissions (view, create, edit, delete, approve), so that I can delegate tasks without giving full access.
* As a Business Owner, I want to audit who did what and when, so that I can track accountability.

**UX/UI Considerations**

**Core Experience**

1. **User Management Dashboard**: Accessible via Settings → Team Management. Shows table of all users with columns: Name, Email, Roles (badge pills), Status (Active/Inactive), Last Active, Actions (Edit/Deactivate).

2. **Add User Flow**:
   - "Add Team Member" button (top right)
   - Modal form: Name, Email, Phone
   - "Assign Roles" multi-select dropdown with role pills
   - Toggle: "Send invitation email now"
   - "Add User" button (disabled until Name + Email + at least 1 role selected)

3. **Role Assignment Interface**: 
   - **Base Roles** (included in plan): Business Admin, Warehouse Manager, Procurement Manager, Sales Manager, Store Manager displayed as selectable cards with icons and descriptions
   - **Premium Roles** (PKR 100/month each): Cashier/POS Operator, District Manager, Accountant, Clinical Services Coordinator, Data Analyst, Operations Manager, Front-End Supervisor, Receiving Clerk, Delivery Coordinator shown with lock icons if not subscribed
   - Multi-select allows selecting multiple roles per user
   - Visual indicator: "3 base roles + 2 premium roles assigned (PKR 200/month added)"

4. **Permission Matrix View**: Advanced users can click "View Permissions" to see detailed matrix:
   - Rows: Features (Inventory, POS, Procurement, Reports, etc.)
   - Columns: Permissions (View, Create, Edit, Delete, Approve)
   - Cells: Checkboxes indicating what each role can do
   - Read-only view showing combined permissions for user with multiple roles

5. **First-Time User Login**: When new user logs in:
   - Onboarding tooltip tour: "Welcome! Let's show you around."
   - Highlights key features available to their role
   - Skippable with "Skip Tour" button
   - Progress dots at bottom: "1 of 5"

6. **Customizable Dashboard** (for users with multiple roles):
   - Dashboard initially shows combined widgets from all assigned roles
   - "Customize Dashboard" button (top right) opens edit mode
   - Edit mode: All available widgets shown in sidebar, drag-and-drop to add/remove
   - Widget categories: Sales Metrics, Inventory Alerts, Pending Approvals, Financial Summary, Team Performance
   - Layout grid: 2 columns on mobile, 3 on tablet, 4 on desktop
   - Widgets can be resized: Small (1x1), Medium (2x1), Large (2x2)
   - "Save Layout" button persists preferences

7. **Permission Denied Handling**: When user tries to access restricted feature:
   - Friendly error page (not harsh): "You don't have access to this feature"
   - Subtext: "Contact your admin (admin@business.com) if you need access"
   - "Go to Dashboard" button
   - No technical jargon or error codes

**States**

* **Active User**: Green status badge, can log in and access features
* **Inactive User**: Gray badge, login blocked, appears dimmed in user list
* **Pending Invitation**: Yellow badge, user hasn't accepted invitation yet
* **Premium Role Locked**: Lock icon with "Upgrade Plan" button if business hasn't purchased
* **Dashboard Edit Mode**: Widgets have grip handles for dragging, delete (X) buttons, semi-transparent overlay

**Visual Hierarchy**

* Base roles use brand primary color badges
* Premium roles use gradient badges (purple to blue) to distinguish
* Permission matrix uses color coding: Green (allowed), Red (denied), Gray (not applicable)
* Dashboard widgets have subtle cards with shadows, colored headers matching their category

**Animations**

* Role badge pills: Smooth pop-in animation when added (scale from 0.8 to 1.0)
* Dashboard widget rearrangement: Smooth reflow when dragging (other widgets shift with elastic easing)
* Permission matrix: Row highlight on hover with 100ms fade-in
* Permission denied page: Gentle shake animation (3 times, 400ms total) to convey friendly rejection

**Advanced Users & Edge Cases**

**Edge Case: User with Multiple Roles Has Conflicting Permissions**

* **State**: User is both "Cashier" (can't approve discounts) and "Store Manager" (can approve discounts)
* **Handling**: System uses "most permissive wins" logic. If any role allows an action, user can perform it.
* **Visual**: Permission matrix shows combined permissions with tooltip: "Allowed via Store Manager role"

**Edge Case: Business Downgrades Plan, Loses Premium Roles**

* **State**: Business cancels premium role subscription, but users are still assigned those roles
* **Handling**: System shows admin warning modal on next login: "Your premium roles expired. 5 users will lose access. Reassign them to base roles or renew subscription."
* **Visual**: User management page shows affected users with orange warning badges
* **Grace Period**: 7-day grace period before access is revoked, countdown shown in banner

**Edge Case: Admin Accidentally Locks Themselves Out**

* **State**: Only admin removes their own admin role
* **Handling**: System prevents this with validation: "You're the only admin. Assign another admin first before removing your role."
* **Visual**: Modal blocker with warning icon, "Assign Another Admin" button
* **Safeguard**: At least 1 user must have Business Admin role at all times

**Edge Case: User Deactivated Mid-Session**

* **State**: User is logged in and using app when admin deactivates their account
* **Handling**: On next API request, system returns 401 Unauthorized. Frontend shows modal: "Your account has been deactivated. Please contact your administrator."
* **Visual**: Can't dismiss modal, only option is "Log Out" button
* **Data**: Current session data is saved before logout (e.g., unsaved POS transaction in draft state)

**Edge Case: Dashboard Widget Fails to Load**

* **State**: Sales Metrics widget API times out
* **Handling**: Widget shows error state: "Unable to load data" with retry button
* **Visual**: Red error icon, but other widgets continue functioning normally
* **Retry**: Retry button calls API again with exponential backoff

**Edge Case: Mobile User with Many Roles (15+ widgets available)**

* **State**: User has Business Admin + Sales Manager + Warehouse Manager roles = 40 potential widgets
* **Handling**: Dashboard defaults to top 8 most important widgets, "View More" button expands to show rest
* **Visual**: Scrollable dashboard with "Scroll for more" hint animation
* **Customization**: User can reorder to prioritize their preferred widgets at top

---

### Business Onboarding & Configuration

#### Business Profile Setup

**User Stories**

* As a new business owner, I want to set up my business profile quickly, so that I can start managing operations immediately.
* As a pharmacy owner, I want to configure my tax settings correctly, so that my reports are compliant with local regulations.
* As a multi-location business, I want to define my organizational hierarchy, so that inventory flows correctly between locations.
* As a business admin, I want to edit my configuration after initial setup, so that I can adapt as my business grows.

**UX/UI Considerations**

**Core Experience**

1. **Business Information Section** (Settings → Business Profile):
   - Read-only display mode by default: Business name, Contact number, Primary address, Business type
   - "Edit Profile" button (top right) switches to edit mode
   - Edit mode: Form fields become editable with save/cancel buttons
   - Real-time validation on required fields
   - Changes require confirmation: "Save changes?" modal before committing

2. **Currency & Tax Configuration**:
   - **Currency Section**: Shows current currency (e.g., "PKR - Pakistani Rupee") with country flag icon
   - Change currency button shows warning: "Changing currency affects all financial data. Existing transactions won't be converted."
   - Confirmation required with password re-entry
   - **Tax Configuration**: Table showing tax rules:
     - Columns: Tax Name, Rate (%), Applies To (Products/Services), Effective From
     - "Add Tax Rule" button opens modal form
     - Can edit/deactivate existing rules (but not delete if transactions exist)

3. **Fiscal Year Settings**:
   - Dropdown: "Fiscal year starts on..." with month selection
   - Shows impact: "Current fiscal year: July 2024 - June 2025"
   - Warning if changing mid-year: "This affects financial reporting. Existing reports may need regeneration."

4. **Compliance Settings**:
   - **Country Selection**: Dropdown determines which compliance framework loads
   - For Pakistan:
     - Toggle: "Enable controlled substances tracking"
     - Toggle: "Require prescriptions for narcotics"
     - Toggle: "Enable pharmacovigilance reporting"
   - For other countries: Generic toggles with text fields to customize

5. **Location Hierarchy Builder**:
   - Visual tree diagram showing organizational structure
   - Root node: Head Office (always exists, can't be deleted)
   - Add child locations via "+ Add Location" buttons on each node
   - Drag-and-drop to reorganize hierarchy (with validation to prevent circular dependencies)
   - Each node shows: Location name, Type (Head Office/Regional/Store), Manager name, Active status
   - Click node to view details panel (right sidebar): Address, Contact info, Assigned users, Stock summary

**States**

* **View Mode**: All fields read-only with subtle gray backgrounds
* **Edit Mode**: Fields editable with white backgrounds, blue focus rings
* **Saving**: Loading spinner on save button, form disabled
* **Saved Successfully**: Green checkmark animation, brief success toast
* **Validation Error**: Red borders on invalid fields with error messages below
* **Hierarchy Tree**: Collapsed nodes (shows +), Expanded nodes (shows children), Hover state (highlights node with shadow)

**Visual Hierarchy**

* Section headers: Large bold text with subtle bottom border
* Critical settings (currency, fiscal year): Yellow warning icons to indicate importance
* Location tree: Color-coded by type (Head Office: Blue, Regional: Green, Store: Orange)
* Save buttons: Large, prominent, fixed at bottom of screen on mobile

**Animations**

* Tree expand/collapse: Smooth slide animation (300ms) with children fading in
* Drag-and-drop: Node lifts with shadow increase, other nodes shift to show drop targets
* Save success: Checkmark scales from 0 to 1.2x to 1x (elastic bounce) over 500ms
* Field focus: Border color transition (200ms) from gray to blue

**Advanced Users & Edge Cases**

**Edge Case: Changing Currency After 1000+ Transactions**

* **State**: Business has 6 months of sales in PKR, wants to switch to USD
* **Handling**: System shows blocking modal: "You have 1,247 transactions in PKR. Changing currency will not convert historical data. Are you sure?"
* **Visual**: Red warning modal with "I understand, change currency" button requiring confirmation
* **Alternative**: Suggest creating new business entity for USD operations instead

**Edge Case: Deleting Location with Active Inventory**

* **State**: User tries to delete a store that has 500 products in stock
* **Handling**: System prevents deletion: "Cannot delete location with active inventory (500 items). Transfer inventory first or mark location as inactive."
* **Visual**: Error modal with "Transfer Inventory" button (launches transfer wizard) or "Mark Inactive" option
* **Soft Delete**: Inactive locations don't show in dropdowns but preserve historical data

**Edge Case: Circular Hierarchy (Store A parent of Store B, Store B parent of Store A)**

* **State**: User drags Store A to be child of Store B, but Store B is already child of Store A
* **Handling**: System blocks the operation during drag: Drop target shows red × icon instead of green ✓
* **Visual**: Tooltip on hover: "Cannot create circular relationship"

**Edge Case: Multiple Users Editing Configuration Simultaneously**

* **State**: Admin A and Admin B both edit business profile, Admin A saves first
* **Handling**: When Admin B tries to save, system shows conflict modal: "Another user updated this. Refresh to see latest changes or overwrite their updates."
* **Visual**: Side-by-side comparison showing current values vs. Admin A's changes
* **Resolution**: Admin B can choose field-by-field which values to keep

**Edge Case: Tax Rule Effective Date in Past**

* **State**: User creates tax rule with "Effective From: Jan 1, 2024" but current date is Jun 1, 2024
* **Handling**: System allows it but shows warning: "This tax rate will apply retroactively to past transactions. Financial reports may change."
* **Visual**: Yellow info banner with "Recalculate Reports" button to trigger batch update

---

### Point of Sale (POS)

#### Mobile POS Core Experience

**User Stories**

* As a cashier, I want to quickly scan products and complete sales, so that customers don't wait in long queues.
* As a pharmacist, I want to see expiry warnings during checkout, so that I don't sell near-expiry products unknowingly.
* As a store owner, I want multiple staff to operate separate counters simultaneously, so that we can serve many customers during peak hours.
* As a mobile cashier, I want the POS to work offline, so that sales continue even if internet is down.
* As a customer-facing staff, I want to send receipts via WhatsApp, so that customers get instant digital records without needing a printer.

**UX/UI Considerations**

**Core Experience**

1. **POS Home Screen**:
   - **Top Bar**: Current counter name (e.g., "Counter 1"), logged-in cashier name, time, sync status icon (green = online, orange = syncing, red = offline)
   - **Search Bar**: Prominent at top, autofocus on load, placeholder: "Search product or scan barcode"
   - **Product Grid** (below search): 3x2 grid on mobile showing 6 most frequently sold items with images, names, prices. Tap to add to cart.
   - **Floating Action Button** (bottom right): Camera icon for barcode scanning
   - **Cart Badge**: Shopping cart icon (top right) with count badge showing items in cart

2. **Product Search**:
   - **Instant Results**: As user types, shows dropdown with matching products
   - **Search Criteria**: Matches product name, generic name, salt composition, barcode
   - **Result Display**: Product name (bold), generic name (gray), price, stock status (green "In Stock" or red "Low Stock")
   - **Fuzzy Matching**: Handles typos (e.g., "panadol" matches "Panadol", "Paracetamol")
   - **Empty State**: "No products found. Try searching by generic name or salt." with "Add New Product" link

3. **Barcode Scanning**:
   - Tap FAB → Camera opens with scanning overlay
   - **Scanning UI**: Rectangle frame in center, flashlight toggle (top right), "Enter barcode manually" link (bottom)
   - **Auto-Focus**: Camera auto-focuses on barcode, plays sound + haptic feedback on successful scan
   - **Multi-Scan Mode**: After adding product to cart, camera stays open for next scan (toggle: "Scan next item")
   - **Manual Entry**: Shows numeric keypad for typing barcode if camera fails

4. **Adding Products to Cart**:
   - **Quick Add**: Tap product → Adds 1 unit to cart with brief toast notification "Added to cart"
   - **Quantity Adjustment**: Swipe up on product card → Quantity picker modal (- / number input / +)
   - **Cart View**: Swipe cart icon down → Full-screen cart overlay slides up
   
5. **Cart Screen** (slide-up sheet):
   - **Header**: "Cart (3 items)" with close button (swipe down or tap X)
   - **Item List**: Each row shows:
     - Product name + batch expiry (if <60 days, yellow badge; if <30 days, red badge)
     - Quantity controls (- / input / +)
     - Unit price
     - Subtotal (quantity × price)
     - Delete icon (swipe left reveals delete button)
   - **Batch Override**: If multiple batches available, tap product → Shows batch selector: "Batch A (Exp: Mar 2025) - 50 units" vs "Batch B (Exp: Jun 2025) - 30 units". FEFO batch pre-selected, can override.
   - **Customer Selector**: Below items, dropdown "Customer: Walk-in Customer" with search
   - **Customer Info**: If credit customer selected, shows "Available Credit: PKR 5,000" in green or red if limit exceeded
   - **Discount Section**: "Apply Discount" button → Modal with discount type (% or flat amount), requires manager PIN if discount >10%
   - **Price Summary**: Subtotal, Discount, Tax, **Total** (large, bold)
   - **Payment Button**: Fixed at bottom, "Complete Sale - PKR 1,250" (disabled if credit limit exceeded)

6. **Payment Screen**:
   - **Payment Methods**: Large button grid:
     - Cash (icon: bills)
     - Card (icon: credit card)
     - Mobile Wallet (icon: phone)
     - Credit/On-Account (icon: calendar)
     - Split Payment (icon: split arrows)
   - **Cash Payment**: Shows numeric keypad, "Amount Received" input, calculates change automatically
     - Change display: "Change to return: PKR 50" in large green text
   - **Card Payment**: "Processing..." with spinner, integrates with payment terminal via Bluetooth/NFC
   - **Split Payment**: Shows multiple payment method inputs with running total

7. **Receipt Options**:
   - After payment confirmed, modal: "How should we send the receipt?"
   - **Options**:
     - WhatsApp (icon + "Send to customer's WhatsApp") → Input phone number field
     - Print (icon + "Print receipt") → Connects to Bluetooth thermal printer
     - Email (icon + "Email receipt") → Input email field
     - None (text link: "No receipt needed")
   - **WhatsApp Integration**: Pre-fills message: "Thank you for your purchase at [Business Name]! Your receipt:" + PDF link
   - **Success**: Shows sent confirmation with checkmark animation

8. **Transaction Complete**:
   - Success screen (brief, 2 seconds): Green checkmark, "Sale completed - PKR 1,250"
   - Auto-returns to POS home screen
   - Cart clears, ready for next customer

**States**

* **Empty Cart**: Cart icon has no badge, "Complete Sale" button disabled
* **Cart with Items**: Cart badge shows count (1-9 or "9+"), button enabled
* **Loading Product**: Skeleton screens for product grid while loading
* **Offline Mode**: Orange banner at top "Working Offline - Sales will sync when online", cart icon has orange dot
* **Syncing**: Blue banner "Syncing 3 transactions..." with progress bar
* **Low Stock Warning**: Product shows orange "Low Stock" badge, can still add to cart
* **Out of Stock**: Product grayed out, can't add to cart
* **FEFO Warning**: Yellow banner in cart: "Near-expiry batch selected (Exp: Feb 2025). Override?" with batch selector link
* **Credit Limit Exceeded**: Red banner in cart: "Credit limit exceeded by PKR 500. Cannot proceed." Payment button disabled unless manager override.

**Visual Hierarchy**

* Search bar: Largest touch target (56px height) with blue focus ring
* Product grid cards: Images (80x80px), product names (16px bold), prices (14px, brand color)
* Cart total: 24px bold font, brand primary color, stands out visually
* Payment method buttons: Large (120x80px), icons prominent, labels below
* Receipt options: Equal visual weight, use icons + text for clarity

**Animations**

* Add to cart: Product card briefly scales to 1.1x then back with elastic easing (300ms)
* Cart slide up: Smooth slide from bottom with backdrop fade-in (250ms)
* Quantity change: Number animates (count up/down) when +/- tapped
* Payment success: Checkmark draws from center outward (SVG animation, 600ms)
* Receipt sent: WhatsApp icon bounces with green checkmark overlay (400ms)

**Advanced Users & Edge Cases**

**Edge Case: FEFO Override Requested by Customer**

* **State**: Customer sees near-expiry batch and asks for longer expiry
* **Handling**: Cashier taps batch override in cart → Selects batch with later expiry → System logs override with reason field: "Customer requested"
* **Visual**: Modal with two batch options, radio buttons, "Reason for override" text field (optional), "Confirm Override" button
* **Manager Notification**: Override logged in daily report, sent to manager: "10 FEFO overrides today"

**Edge Case: Payment Terminal Disconnected Mid-Transaction**

* **State**: Card payment selected but Bluetooth printer/terminal offline
* **Handling**: Error modal: "Payment terminal not connected. Reconnect or choose another method."
* **Visual**: Red error with "Retry Connection" button and "Cancel Payment" option
* **Fallback**: Transaction stays in "Pending Payment" state, cart preserved, can switch to cash

**Edge Case: Multiple Items with Same Product, Different Batches**

* **State**: Cashier scans same product twice from different batches
* **Handling**: System creates separate line items in cart: "Panadol (Batch A, Exp: Mar 2025) - 2 units" and "Panadol (Batch B, Exp: Jun 2025) - 1 unit"
* **Visual**: Line items distinguished by batch info in gray subtext

**Edge Case: Customer Wants to Return Mid-Transaction**

* **State**: Cashier added 5 items, customer changes mind about 2 items
* **Handling**: Swipe left on cart item → Red delete button → Remove item → Cart recalculates
* **Visual**: Smooth slide-left animation, item fades out, others shift up

**Edge Case: Offline for 24+ Hours, 500+ Queued Transactions**

* **State**: Internet outage, POS operated offline for a day, 500 sales queued
* **Handling**: When internet restored, sync engine uploads all 500 immediately in batches of 50 (server-side processing)
* **Visual**: Progress banner: "Syncing offline sales... 150/500 completed" with progress bar
* **Priority**: Sync newest transactions first (LIFO) so latest sales appear in reports quickly

**Edge Case: Manager PIN Required but Manager Offline**

* **State**: Discount >10% requested, requires manager PIN, manager not available
* **Handling**: Modal: "Manager approval required for 15% discount. Options:"
   - Enter manager PIN (numeric keypad)
   - Request remote approval (sends push notification to manager with approve/reject buttons)
   - Proceed with maximum allowed discount (10%)
* **Visual**: Three cards with radio buttons, submit button
* **Remote Approval**: Manager gets notification: "Discount approval request from Counter 2: 15% on PKR 5,000 sale. Approve?" with timer (expires in 5 min)

**Edge Case: Duplicate Barcode Scanned (Two Products with Same Barcode)**

* **State**: Database has duplicate barcodes due to import error
* **Handling**: Scanner finds 2 matches → Shows product selector modal: "Multiple products found. Which one?" with product cards
* **Visual**: Side-by-side cards with images, names, prices, stock levels
* **Selection**: Tap product → Adds to cart
* **Admin Alert**: System logs duplicate barcode, sends alert to admin: "Fix duplicate barcodes in inventory"

---

#### Multi-Counter Operations & End-of-Day Reconciliation

**User Stories**

* As a store manager, I want each cashier to operate an independent cash drawer, so that we can reconcile individually at shift end.
* As a cashier, I want to see my counter's sales summary, so that I know how much cash I should have in my drawer.
* As a store manager, I want to close all counters simultaneously at end of day, so that we can quickly reconcile and secure cash.
* As an accountant, I want detailed reports per counter, so that I can track individual performance and detect discrepancies.

**UX/UI Considerations**

**Core Experience**

1. **Counter Assignment**:
   - **Login Screen**: After user logs in, if they have Cashier/POS Operator role, system shows: "Select your counter:"
   - **Counter Grid**: Shows all defined counters for this location (Counter 1, Counter 2, ..., Counter 6)
   - **Status Indicators**: 
     - Green: Available (no one logged in)
     - Blue: In Use by [Name] (can't select unless you're that user resuming)
     - Red: Locked (counter closed for reconciliation)
   - **Counter Details**: Each card shows: Counter name, Current cashier (if any), Session start time, Transaction count today, Sales total today
   - **Selection**: Tap available counter → Prompts "Starting cash amount in drawer?" → Numeric input → "Start Session" button

2. **Session Start**:
   - After entering starting cash, system creates session record
   - Cashier lands on POS home with persistent header: "Counter 2 • Session started: 9:00 AM"
   - Floating info button (i icon) shows session details: Starting cash, Sales count, Total sales, Cash collected, Card payments, Credit sales

3. **Ongoing Session**:
   - All sales are tagged with counter_id and session_id
   - Cashier can't switch counters mid-session (must close current session first)
   - If another user tries to take over counter: Shows error "Counter in use by [Name]. Ask them to close session first."

4. **Session Summary** (accessible via floating info button):
   - **Expandable Panel**: Slides from right with summary data
   - **Sections**:
     - **Expected Cash**: Starting cash + Cash sales - Cash refunds = PKR 12,500
     - **Transaction Breakdown**: 
       - Sales: 45 transactions (PKR 15,000)
       - Returns: 2 transactions (PKR 500)
       - Discounts Given: PKR 200
     - **Payment Method Split**:
       - Cash: PKR 10,000
       - Card: PKR 4,000
       - Credit: PKR 1,000
   - **Close Session** button (bottom of panel)

5. **Close Session (Cashier-Initiated)**:
   - Tap "Close Session" → Shows closing wizard
   - **Step 1: Count Cash**
     - Prompt: "Count the cash in your drawer"
     - Denomination breakdown:
       - PKR 5000 notes: [input] × PKR 5000 = PKR [auto-calc]
       - PKR 1000 notes: [input] × PKR 1000 = PKR [auto-calc]
       - PKR 500 notes: [input] × PKR 500 = PKR [auto-calc]
       - (continues for all denominations)
     - **Total Counted**: PKR 12,450 (auto-sum)
     - **Expected**: PKR 12,500
     - **Variance**: -PKR 50 (shown in red if short, green if over, gray if exact)
   
   - **Step 2: Explain Variance** (if variance exists):
     - Text field: "Reason for variance" (optional but encouraged)
     - Examples shown: "Customer paid PKR 10 short and left", "Mistakenly gave extra change", "Cash drawer stuck, pulled PKR 50 to fix"
   
   - **Step 3: Confirm Closing**:
     - Summary screen showing session stats, variance, reason
     - "Close Session & Print Report" button
     - "Save as Draft & Continue Later" link (locks counter but doesn't finalize)

6. **End-of-Day Reconciliation (Manager-Initiated)**:
   - **Manager View**: Settings → End of Day → Shows all counters for location
   - **Table View**:
     - Columns: Counter, Cashier, Status (Open/Closed/Draft), Expected Cash, Variance, Actions
     - Filters: Show only open sessions, Show all
   - **Bulk Close**: "Close All Open Sessions" button → Sends notification to all cashiers: "Manager is closing EOD. Finalize your session now."
   - **Force Close**: If cashier doesn't respond in 10 min, manager can force close → Creates variance report with note "Closed by manager - cashier unavailable"

7. **EOD Report Generation**:
   - After all sessions closed, "Generate EOD Report" button becomes available
   - Report includes:
     - **Summary**: Total sales, total transactions, payment method breakdown, total discounts, total returns
     - **Per Counter**: Individual performance (sales, variance, top cashier)
     - **Variance Analysis**: Total variance across all counters, reasons logged
     - **Outstanding Credit**: Total credit sales pending payment
   - **Actions**: Export to PDF, Export to Excel, Email to accountant, Archive report

**States**

* **Counter Available**: Green card, "Start Session" button visible
* **Counter In Use**: Blue card with cashier name and session stats, disabled
* **Session Open**: POS fully functional, "Close Session" button available
* **Session Closed**: Counter locked (red), shows "Closed at [time]" with variance
* **Session Draft**: Orange, shows "Resume Session" button for same cashier, locked for others
* **Variance Exists**: Yellow/red indicator with variance amount
* **No Variance**: Green checkmark
* **EOD in Progress**: All counters show "Reconciliation in progress" banner

**Visual Hierarchy**

* Counter status: Large status badges (Available/In Use/Closed) color-coded
* Variance: Bold, colored numbers (red for short, green for over) with ±sign
* Expected vs Counted: Side-by-side comparison with clear labels
* Session summary panel: Organized into sections with subtle dividers
* EOD report: Tables with alternating row colors for readability

**Animations**

* Counter selection: Selected card lifts with shadow increase (200ms)
* Session summary slide-in: Smooth slide from right with backdrop fade (300ms)
* Denomination calculator: Auto-sum animates count-up when values entered
* Variance indicator: Pulses gently if discrepancy >PKR 100 (orange if <PKR 500, red if >PKR 500)
* EOD report generation: Loading spinner with progress steps ("Calculating totals... Generating PDF...")

**Advanced Users & Edge Cases**

**Edge Case: Cashier Forgets to Close Session, Leaves for Day**

* **State**: Session open since 9 AM, cashier left at 5 PM without closing
* **Handling**: Manager can force close via EOD screen → Creates variance report with note "Session closed by manager [name] at [time]. Cashier did not close properly."
* **Visual**: Orange warning in EOD table for this counter: "Unclosed session - Force close?"
* **Implications**: Variance marked as "Unreconciled - requires follow-up"

**Edge Case: Large Variance (>PKR 1000)**

* **State**: Cashier counts PKR 11,500 but expected PKR 12,500 (short PKR 1000)
* **Handling**: System blocks session closure: "Large variance detected (PKR 1,000 short). Manager approval required."
* **Visual**: Red modal with "Request Manager Approval" button
* **Manager Approval**: Manager receives notification, can approve (with reason) or reject (cashier recounts)

**Edge Case: Multiple Sessions for Same Counter in One Day**

* **State**: Morning cashier closes session at 12 PM, afternoon cashier starts new session on same counter
* **Handling**: System allows it, tracks separately: Session 1 (9 AM - 12 PM) and Session 2 (12 PM - 5 PM)
* **Visual**: EOD report shows both sessions under same counter with time ranges
* **Starting Cash**: Afternoon session starting cash = Morning session closing cash + any cash deposits to bank

**Edge Case: System Offline During Session Close**

* **State**: Cashier counts cash, enters variance reason, taps "Close Session" but internet down
* **Handling**: System saves session closure to local SQLite queue, shows: "Saved offline. Will finalize when online."
* **Visual**: Orange "Pending Sync" badge on counter
* **Manager View**: EOD shows "Closed (offline)" status, can generate partial report

**Edge Case: Cashier Needs Break Mid-Session**

* **State**: Counter in use, cashier wants 30-min break
* **Handling**: "Lock Counter" button → Requires PIN to unlock → Counter shows "Locked - Resume with PIN"
* **Visual**: Blue card with lock icon, shows "Locked by [Name] at [time]"
* **Resume**: Same cashier enters PIN → Session resumes exactly where it left off

**Edge Case: Printer Failure During EOD Report**

* **State**: Manager tries to print EOD report, printer offline
* **Handling**: System shows error but provides alternatives: "Printer unavailable. Export to PDF or Email report instead?"
* **Visual**: Modal with "Export PDF", "Email Report", "Retry Printing" buttons
* **Fallback**: Report data saved to database, can regenerate/print later

---

### Inventory Management

#### Product Master & Catalog Management

**User Stories**

* As a warehouse manager, I want to add products with detailed attributes, so that I can track pharmacy-specific data like salt composition and dosage form.
* As a retail business owner, I want flexible product attributes (size, color, brand), so that I can adapt the system for non-pharmacy items.
* As a procurement manager, I want to set reorder points per product, so that I get alerts when stock runs low.
* As a pharmacist, I want to generate barcodes for products that don't have them, so that I can use the barcode scanner for all items.
* As a manager, I want to categorize products into hierarchies, so that reporting and filtering is easier.

**UX/UI Considerations**

**Core Experience**

1. **Product List View** (Inventory → Products):
   - **Header**: Search bar (top), filter icon, sort icon, "Add Product" button (primary CTA)
   - **View Toggle**: List view (default) vs Grid view (tap icon to switch)
   - **List View**: Table with columns:
     - Product image (thumbnail 40x40px)
     - Name + Generic name (subtext in gray)
     - Category
     - Barcode
     - Stock level (color-coded: green >50, yellow 10-50, red <10)
     - Price
     - Status (Active/Inactive toggle)
     - Actions (Edit/View/Duplicate icons)
   - **Grid View**: 2 columns on mobile, 3 on tablet, 4 on desktop. Each card shows product image, name, price, stock badge.
   - **Bulk Actions**: Checkbox column, select multiple → Toolbar appears: "Export Selected", "Bulk Edit", "Mark Inactive"
   
2. **Filters Panel** (tap filter icon):
   - **Slide-in from right**
   - **Filter Options**:
     - Category (multi-select dropdown with nested categories)
     - Stock Status (In Stock, Low Stock, Out of Stock)
     - Price Range (slider with min/max inputs)
     - Status (Active, Inactive, All)
   - **Applied Filters**: Shown as dismissible pills below search bar
   - **Clear All** button
   - **Apply Filters** button (primary)

3. **Add Product Flow**:
   - **Tap "Add Product"** → Opens full-screen form (modal on desktop)
   - **Form Sections** (accordions, can expand/collapse):
     
     **Section 1: Basic Information** (expanded by default)
     - Product Name* (required, max 100 chars)
     - Generic Name (optional, for pharmacy)
     - Category* (searchable dropdown with "Create New Category" option)
     - Sub-Category (depends on selected category)
     - Product Description (multi-line text area)
     - Product Image (tap to upload from camera/gallery, shows preview)
     
     **Section 2: Identification**
     - Barcode (input field with "Scan Barcode" button and "Generate Barcode" link)
     - SKU/Item Code (auto-generated but editable)
     - Manufacturer (searchable dropdown with "Add New" option)
     - Brand (searchable dropdown)
     
     **Section 3: Pharmacy-Specific Attributes** (conditionally shown if business type = Pharmacy)
     - Salt Composition (text input, e.g., "Paracetamol 500mg")
     - Dosage Form (dropdown: Tablet, Capsule, Syrup, Injection, Cream, Ointment, etc.)
     - Strength (e.g., "500mg", "10mg/ml")
     - Pack Size (e.g., "10 tablets", "100ml bottle")
     - Prescription Required (toggle)
     - Controlled Substance (toggle, if yes → shows schedule dropdown)
     
     **Section 4: Retail-Specific Attributes** (conditionally shown if business type = Retail/FMCG)
     - Size (e.g., "Large", "Medium", "Small")
     - Color (e.g., "Red", "Blue")
     - Weight/Volume (e.g., "1kg", "500ml")
     
     **Section 5: Pricing & Stock**
     - Unit of Measure* (dropdown: Piece, Box, Pack, Kg, Liter, etc.)
     - Base Price* (PKR, required)
     - Tax Category (dropdown: Standard Rate, Reduced Rate, Zero-Rated, Exempt)
     - Minimum Stock Level* (alert triggers when stock ≤ this value)
     - Reorder Point (when to reorder, can be same as min stock or higher)
     - Reorder Quantity (how much to order when reorder triggered)
     - Maximum Stock Level (optional, for preventing overstocking)
     
     **Section 6: Supplier & Procurement**
     - Primary Supplier (searchable dropdown)
     - Purchase Price (cost from supplier)
     - Lead Time (days between PO and delivery)
     - Minimum Order Quantity (MOQ from supplier)
     
   - **Barcode Generation**: 
     - Tap "Generate Barcode" → Modal: "Select barcode type" (Code 128, EAN-13, QR Code)
     - System generates unique barcode → Shows preview → "Use This Barcode" button
     - Generated barcode is SVG, can download or print labels
   
   - **Validation**:
     - Real-time validation on required fields (red border + error message if invalid)
     - Duplicate barcode check (shows warning: "This barcode exists for [Product Name]. Use anyway?")
     - Price > 0 validation
     - Min stock < Max stock validation
   
   - **Save Options**:
     - "Save" button (bottom): Saves and returns to product list
     - "Save & Add Another" button: Saves and clears form for next product
     - "Save as Draft" link: Saves with Inactive status
     - "Cancel" link: Discards changes (confirmation modal if any fields filled)

4. **Product Detail View**:
   - **Tap product row** → Opens detail page
   - **Header**: Product image (large, 200x200px), name, category breadcrumb
   - **Tabs**: Details, Stock Levels, Batches, Transaction History, Performance
   
   **Tab 1: Details**
   - All product info in read-only mode (same structure as add form)
   - "Edit Product" button (top right) switches to edit mode
   
   **Tab 2: Stock Levels**
   - Table showing stock per location:
     - Columns: Location, Available Stock, Reserved Stock, In-Transit, Reorder Level, Status
     - Color coding: Green (stock > reorder point), Yellow (near reorder point), Red (below)
   - "Adjust Stock" button (opens stock adjustment modal)
   - "Transfer Stock" button (initiates transfer wizard)
   
   **Tab 3: Batches** (pharmacy-specific)
   - Table: Batch Number, Manufacturing Date, Expiry Date, Quantity, Status (Active, Expiring Soon, Expired, Recalled)
   - Sort by expiry date (nearest first)
   - Warning badges for batches expiring <90 days
   - "Mark for Discount" action for near-expiry batches
   
   **Tab 4: Transaction History**
   - Chronological list: Date, Transaction Type (Sale, Purchase, Transfer, Adjustment), Quantity, Location, User
   - Pagination (50 records per page)
   - Export to CSV option
   
   **Tab 5: Performance**
   - **KPIs**: 
     - Total sales (last 30/90/365 days, toggle)
     - Profit margin %
     - Inventory turnover ratio
     - Average sale price
     - Stockout incidents (count of times stock = 0)
   - **Chart**: Sales trend over time (line chart, toggleable timeframe)

**States**

* **Loading**: Skeleton screens for product list (gray animated bars)
* **Empty State**: Illustration with "No products yet. Add your first product to get started." + "Add Product" button
* **Filtered Results Empty**: "No products match your filters. Try adjusting or clearing filters."
* **Low Stock**: Product row highlighted with yellow background + warning icon
* **Out of Stock**: Product row grayed out with red "Out of Stock" badge
* **Inactive Product**: Dimmed appearance with "Inactive" badge, excluded from POS by default
* **Image Upload**: Drag-and-drop zone with "Drag image here or click to browse", loading spinner during upload
* **Barcode Scanning**: Camera overlay with scanning frame, "Hold barcode in frame" instruction

**Visual Hierarchy**

* Product images: Prominent but not overwhelming (40px in list, 200px in detail)
* Product name: Bold, 16px in list, 24px in detail
* Stock levels: Color-coded badges (green/yellow/red) for quick scanning
* Price: Medium emphasis in list (14px), large in detail (20px)
* CTAs: "Add Product" is primary (blue, large), "Edit" is secondary (outline)
* Category breadcrumb: Small gray text with ">" separators

**Animations**

* List/Grid toggle: Crossfade transition (200ms) between views
* Filter panel: Slide from right with backdrop fade (300ms)
* Form section expand/collapse: Smooth height transition (250ms)
* Image upload: Fade-in preview when upload completes (400ms)
* Stock level changes: Number animates (count up/down) when adjusted
* Product save: Success checkmark scales from center (elastic easing, 500ms)

**Advanced Users & Edge Cases**

**Edge Case: Duplicate Product Name**

* **State**: User tries to add "Panadol 500mg" but it already exists
* **Handling**: System shows warning modal: "Similar product exists: [Product Name]. View existing product or continue adding?"
* **Visual**: Modal with "View Existing" button (opens existing product in new tab) and "Add Anyway" button
* **Note**: Not blocked, just warned (different brands/suppliers may have same name)

**Edge Case: Barcode Collision Across Businesses (Multi-Tenancy)**

* **State**: Barcode "1234567890" exists in Business A, Business B tries to use it
* **Handling**: No conflict, barcodes are scoped per business_id
* **Visual**: No warning shown

**Edge Case: Large Image Upload (>5 MB)**

* **State**: User uploads 10MB product photo
* **Handling**: System shows error: "Image too large (10 MB). Max size is 5 MB. Try compressing the image."
* **Visual**: Red error message with "Retry" button
* **Auto-Compression**: Optionally offer "Compress & Upload" button that client-side compresses to acceptable size

**Edge Case: Product with No Stock History (New Product)**

* **State**: Product added today, Performance tab has no data
* **Handling**: Performance tab shows empty state: "No sales data yet. Check back after some transactions."
* **Visual**: Illustration with message, no charts/KPIs displayed

**Edge Case: Editing Product While Stock Exists**

* **State**: Product has 500 units in stock across 3 locations, admin changes unit of measure from "Piece" to "Box"
* **Handling**: System blocks critical field changes: "Cannot change Unit of Measure for products with existing stock. Create a new product instead."
* **Visual**: Field is disabled (grayed out) with tooltip explaining restriction
* **Allowed Changes**: Name, description, pricing, reorder levels, supplier (don't affect stock calculations)

**Edge Case: Bulk Import with Errors**

* **State**: User imports 1000 products CSV, 50 have invalid barcodes
* **Handling**: System imports 950 valid products, generates error report CSV for 50 failed ones
* **Visual**: Success toast: "950 products imported successfully. 50 failed - download error report to fix."
* **Error Report**: CSV with columns: Row Number, Product Name, Error Message, Data
* **Retry**: User fixes errors in CSV, re-imports just the 50 failed rows

**Edge Case: Product Category Deleted**

* **State**: Admin deletes "Pain Relief" category, 100 products are in that category
* **Handling**: System prevents deletion: "Cannot delete category with products. Move products to another category first."
* **Visual**: Error modal with "View Products" button (filters product list to show affected products)
* **Batch Move**: Bulk action to move all affected products to new category

---

This is comprehensive but getting quite long. Would you like me to:

1. **Continue with remaining features** (Batch Management, Procurement, Multi-Location, Customer Management, AI Intelligence, Reporting, etc.) - this will be a very large document (likely 50,000+ words)

2. **Create a separate document for each major feature category** for easier navigation

3. **Focus on specific features you'd like detailed** right now and save others for later

Let me know your preference and I'll proceed accordingly!